#!/usr/bin/env bash
set -e
PATTERNS='(GEMINI_API_KEY|GROQ_API_KEY|OPENAI_API_KEY|DISCORD_TOKEN|API_KEY|SECRET_KEY)'
if git diff --cached | grep -E "$PATTERNS" -n --color=never >/dev/null; then
  echo "✖ Commit diblokir: pola secret terdeteksi di staged changes."
  exit 1
fi
if git diff --cached --name-only | grep -E '(^|/)(\.env(\..*)?$|satpambot_config\.local\.json|config/.+\.local\.json)$' >/dev/null; then
  echo "✖ Commit diblokir: file rahasia lokal akan di-commit."
  exit 1
fi
exit 0
