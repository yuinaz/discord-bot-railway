{% extends "base.html" %}{% block content %}
<div class='card'><h2>Traffic</h2><div id='traffic'>-</div></div>
<div class='card'><h2>Incident</h2><div id='incident'>0</div></div>
<script>
async function refresh(){const r=await fetch('/api/live');const j=await r.json();document.getElementById('traffic').textContent=`CPU: ${j.cpu??'-'}% â€¢ MEM: ${j.mem??'-'}% â€¢ Req: ${j.requests}`;document.getElementById('incident').textContent=(j.incidents_series||[]).reduce((a,b)=>a+b,0);}setInterval(refresh,5000);refresh();
</script>
<div id="floatingBans" style="position:fixed;right:16px;bottom:16px;max-width:360px;z-index:9999;"></div>
<script>
(function(){
  const root = document.getElementById('floatingBans'); const seen = new Set();
  function card(item){
    const el = document.createElement('div'); el.className='card shadow-lg mb-2';
    el.style.transition='transform .2s ease, opacity .2s ease'; el.style.transform='translateY(20px)'; el.style.opacity='0';
    el.innerHTML = `<div class="card-body p-2">
      <div class="d-flex justify-content-between align-items-center">
        <div><strong>ðŸš« Banned</strong></div>
        <small class="text-muted">${new Date((item.ts||0)*1000).toLocaleTimeString()}</small>
      </div>
      <div class="mt-1 small">${item.user_name || 'Unknown'} <span class="text-muted">(${item.user_id||''})</span></div>
      <div class="small text-muted">${item.guild_name || ''}</div>
    </div>`;
    requestAnimationFrame(()=>{ el.style.transform='translateY(0)'; el.style.opacity='1'; });
    setTimeout(()=>{ el.style.transform='translateY(10px)'; el.style.opacity='0'; setTimeout(()=>el.remove(), 300); }, 10000);
    return el;
  }
  async function tick(){
    try{
      const r = await fetch('/api/recent-bans'); const j = await r.json();
      (j.items||[]).forEach(it=>{
        const key = it.key || (it.guild_id+'-'+it.user_id+'-'+it.ts);
        if(!key || seen.has(key)) return; seen.add(key);
        root.prepend(card(it)); while(root.children.length>6){ root.lastChild.remove(); }
      });
    }catch(e){}
    setTimeout(tick, 4000);
  }
  tick();
})();
</script>
{% endblock %}
