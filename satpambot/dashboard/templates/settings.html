{% extends "base.html" %}
{% set active="settings" %}
{% block body %}
<h2 style="margin:0 0 14px 0">Settings</h2>
<div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
  <section class="card">
    <h3>Appearance</h3>
    <label class="frow">
      <span>Theme</span>
      <select id="theme">
        <option>Neo</option>
        <option>Dark</option>
        <option>Light</option>
        <option>Nord</option>
        <option>Dracula</option>
        <option>Ocean</option>
        <option>Forest</option>
      </select>
    </label>
    <label class="frow">
      <span>Accent Color</span>
      <input id="accent_color" type="text" placeholder="#2563eb">
    </label>
    <label class="frow">
      <span>Background Mode</span>
      <select id="background_mode">
        <option value="">None</option>
        <option value="image">Image</option>
        <option value="particles">Particles</option>
        <option value="video">Video</option>
      </select>
    </label>
    <label class="frow">
      <span>Background URL</span>
      <input id="background_url" type="text" placeholder="/uploads/your-bg.jpg">
    </label>
    <label class="frow">
      <span>Apply to Login</span>
      <input id="apply_to_login" type="checkbox">
    </label>
    <div class="frow">
      <input id="bg_file" type="file" accept="image/*" />
      <button id="upload" class="btn">Upload</button>
    </div>
    <div class="frow">
      <button id="save" class="btn btn-primary">Save</button>
    </div>
    <div id="saveStatus" class="muted"></div>
  </section>
</div>

<script>
(async function(){
  const $ = (sel)=>document.querySelector(sel);
  const cfg = await fetch('/api/ui-config').then(r=>r.json()).catch(()=>({}));
  $('#theme').value = (cfg.theme||'Neo');
  $('#accent_color').value = (cfg.accent_color||'#2563eb');
  $('#background_mode').value = (cfg.background_mode||'');
  $('#background_url').value = (cfg.background_url||'');
  $('#apply_to_login').checked = !!cfg.apply_to_login;

  $('#upload').addEventListener('click', async ()=>{
    const f = $('#bg_file').files[0]; if(!f) return alert('Pilih file dulu');
    const fd = new FormData(); fd.append('file', f);
    const res = await fetch('/api/upload/background', {method:'POST', body:fd}).then(r=>r.json());
    if(res && res.ok && res.url){ $('#background_url').value = res.url; $('#saveStatus').textContent = 'Uploaded ✔ ' + res.url; } else { $('#saveStatus').textContent = 'Upload gagal'; }
  });

  $('#save').addEventListener('click', async ()=>{
    const body = {
      theme: $('#theme').value,
      accent_color: $('#accent_color').value,
      background_mode: $('#background_mode').value,
      background_url: $('#background_url').value,
      apply_to_login: $('#apply_to_login').checked
    };
    const ok = await fetch('/api/ui-config', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)}).then(r=>r.json()).catch(()=>({ok:false}));
    $('#saveStatus').textContent = ok.ok ? 'Saved ✔' : 'Gagal menyimpan';
  });
})();
</script>
{% endblock %}
