
{% extends "base.html" %}
{% block title %}Settings{% endblock %}
{% block content %}
<h1>Settings</h1>
<form id="uiForm" class="form">
  <div class="grid grid-2">
    <div class="card">
      <label>Logo URL</label>
      <div class="row">
        <input id="logo_url" placeholder="https://.../logo.png">
        <button type="button" class="btn" id="upload_logo_btn">Browse</button>
        <input type="file" id="logo_file" style="display:none" accept="image/*">
      </div>

      <label>Theme</label>
      <select id="theme">
        <option>Dark</option><option>Light</option><option>Nord</option><option>Dracula</option><option>Ocean</option><option>Forest</option>
      </select>

      <label>Background URL</label>
      <div class="row">
        <input id="bg_url" placeholder="https://.../background.jpg">
        <button type="button" class="btn" id="upload_bg_btn">Browse</button>
        <input type="file" id="bg_file" style="display:none" accept="image/*,video/*">
      </div>

      <div class="row">
        <button class="btn" type="submit">Simpan</button>
        <a class="btn ghost" href="javascript:history.back()">Kembali</a>
      </div>
    </div>

    <div class="card">
      <label>Accent Color</label>
      <input id="accent" value="#2563eb">

      <label>Background Mode</label>
      <select id="mode"><option>Image</option><option>Video</option><option>Particles</option></select>

      <label><input type="checkbox" id="apply_login"> Terapkan theme & background ke halaman Login</label>
    </div>
  </div>
</form>

<script>
(async function(){
  // load cfg
  const res = await fetch('/api/ui-config', {credentials:'include'}); 
  const cfg = res.ok ? await res.json(): {};
  document.getElementById('logo_url').value = cfg.logo_url || '';
  document.getElementById('bg_url').value = cfg.background_url || '';
  document.getElementById('theme').value = (cfg.theme||'Dark').replace(/\b\w/g,s=>s.toUpperCase());
  document.getElementById('accent').value = cfg.accent_color || '#2563eb';
  document.getElementById('mode').value = (cfg.background_mode||'Image').replace(/\b\w/g,s=>s.toUpperCase());
  document.getElementById('apply_login').checked = !!cfg.apply_to_login;

  // uploads
  const pickUpload = (btnId, fileId, targetInputId)=>{
    const btn = document.getElementById(btnId);
    const file = document.getElementById(fileId);
    btn.onclick = ()=> file.click();
    file.onchange = async ()=>{
      const f = file.files[0]; if(!f) return;
      const fd = new FormData(); fd.append('file', f);
      const r = await fetch('/api/upload/background', {method:'POST', body: fd});
      const j = await r.json(); if(j.ok && j.url){ document.getElementById(targetInputId).value = j.url; }
    };
  };
  pickUpload('upload_logo_btn','logo_file','logo_url');
  pickUpload('upload_bg_btn','bg_file','bg_url');

  // save
  document.getElementById('uiForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const body = {
      logo_url: document.getElementById('logo_url').value.trim(),
      background_url: document.getElementById('bg_url').value.trim(),
      theme: document.getElementById('theme').value.toLowerCase(),
      accent_color: document.getElementById('accent').value.trim(),
      background_mode: document.getElementById('mode').value.toLowerCase(),
      apply_to_login: document.getElementById('apply_login').checked
    };
    const r = await fetch('/api/ui-config', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
    if(r.ok){ alert('Tersimpan.'); }
  });
})();
</script>
{% endblock %}
