{% extends 'base.html' %}
{% block title %}Pengaturan{% endblock %}
{% block content %}
<div class="card p-3">
  <h4>ðŸŽ¨ Tema & Background â€” live preview</h4>
  <div class="row g-2 align-items-end" style="display:flex; gap:10px; flex-wrap:wrap;">
    <select id="selTheme" class="form-select" style="max-width:260px;">
      {% for t in available_themes %}<option value="{{ t }}" {% if t == current_theme %}selected{% endif %}>{{ t }}</option>{% endfor %}
    </select>
    <button class="btn btn-primary" onclick="applyTheme()">Apply Theme</button>
    <span class="text-muted">/static/themes/*.css</span>
  </div>
  <hr/>
  <div class="row g-2 align-items-end" style="display:flex; gap:10px; flex-wrap:wrap;">
    <input id="bgFile" type="file" accept="image/*" class="form-control" style="max-width:320px;">
    <button class="btn btn-primary" onclick="uploadBg()">Upload & Apply</button>
  </div>

  <hr/>
  <div class="row g-2 align-items-end" style="display:flex; gap:10px; flex-wrap:wrap;">
    <img src="{{ bot_logo_url }}" alt="Logo" style="width:40px;height:40px;border-radius:10px;border:1px solid #ffffff22;object-fit:cover;">
    <input id="logoFile" type="file" accept="image/*" class="form-control" style="max-width:320px;">
    <button class="btn btn-primary" onclick="uploadLogo()">Upload Logo</button>
    <span class="text-muted">Logo akan tampil di login/sidebar</span>
  </div>

<script>
async function applyTheme(){ const t=document.getElementById('selTheme').value; await fetch('/theme?set='+encodeURIComponent(t)); location.reload(); }
async function uploadBg(){
  const f=document.getElementById('bgFile').files[0];
  if(!f) return alert('Pilih file dulu');
  const fd=new FormData(); fd.append('file', f);
  const r=await fetch('/upload/background', {method:'POST', body: fd}); const j=await r.json();
  if(j.status==='success'){ location.reload(); } else { alert(j.message||'Gagal upload'); }
}

async function uploadLogo(){
  const f=document.getElementById('logoFile').files[0];
  if(!f) return alert('Pilih file logo dulu');
  const fd=new FormData(); fd.append('file', f);
  const r=await fetch('/upload/logo', {method:'POST', body: fd});
  const j=await r.json();
  if(j.status==='success'){ location.reload(); }
  else { alert(j.message||'Gagal upload logo'); }
}
</script>
{% endblock %}
